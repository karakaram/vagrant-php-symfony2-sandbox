#!/bin/sh

cd <%= node[:nginx][:document_root] %>

# Install Symfony
/usr/local/bin/composer create-project symfony/framework-standard-edition symfony 2.4.*

# Change permission
chown -R vagrant:vagrant symfony
rm -rf symfony/app/cache/* symfony/app/logs/*
chmod 775 symfony/app/cache symfony/app/logs
#chmod +a "nginx allow delete,write,append,file_inherit,directory_inherit" symfony/app/cache symfony/app/logs
#chmod +a "vagrant allow delete,write,append,file_inherit,directory_inherit" symfony/app/cache symfony/app/logs

# Lets you access app_dev.php from host OS
sed -i 's/127.0.0.1/<%= node[:php][:remote_host] %>/' symfony/web/app_dev.php

# Uncomment umask in app_dev.php
sed -i 's#^//umask(0000)#umask(0000)#' symfony/web/app_dev.php

# Lets you access config.php from host OS
sed -i 's/127.0.0.1/<%= node[:php][:remote_host] %>/' symfony/web/config.php

# Uncomment KERNEL_DIR in phpunit.xml.dist
sed -i 's/^    <!--//' symfony/app/phpunit.xml.dist
sed -i 's/^    -->//' symfony/app/phpunit.xml.dist

# Set KERNEL_DIR in phpunit.xml.dist
sed -i 's#/path/to/your/app/#<%= node[:nginx][:document_root] %>/symfony/app/#' symfony/app/phpunit.xml.dist

exit 0
